<?php

$options = Array();
if (isset($_GET['load']) && is_numeric($_GET['load'])) {
	$options['routeID'] = $_GET['load'];
}
$options = json_encode($options);

$logout_html = "";
if ($RM_native_authentication) {
	$logout_html = <<<EOD
		<div style="position:absolute; bottom:10px;">
		<a href="login.php?logout">logout</a>&nbsp;&nbsp;<a href="login.php?changepass">Change Password</a>
		</div>
EOD;
}

$html = <<<EOD
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Ridemap - Admin</title>
	<script src="//maps.googleapis.com/maps/api/js?libraries=geometry&sensor=false" type="text/javascript"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="../js/ridemap.js" type="text/javascript"></script>
    <link href="../css/ridemap.css" rel="stylesheet" type="text/css"/>
    <link href="../css/ridemapadmin.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">

	var Admin = {
		options: JSON.parse('{$options}'),
		rideMap : null,
		initialize : function() {
		  Admin.rideMap = new Ridemap('map-canvas', {mode: 'admin'});
		  if (Admin.options.routeID) {
			Admin.rideMap.zoomToRoute(Admin.options.routeID);
		  }
		},
		newRoute : function() {
			var bounds =  Admin.rideMap.map.getBounds();
			var sw = bounds.getSouthWest();
			var ne = bounds.getNorthEast();
			window.location = '?id=new&bounds=' + [sw.lat(), sw.lng(), ne.lat(), ne.lng()].join(','); 
		}
	};
	
	$( document ).ready(function() {
		Admin.initialize();
	});

    </script>

  </head>
  <body>
		<div id="control-panel">
			<div id="control-panel-inner">
				<p>Click on a marker to view EDIT and DELETE options for a route</p>
				<p>Click 'New Route' to create a new route</p>
				<div style="margin:8px;"><input type="button" onclick="Admin.newRoute();" value="New Route"/></div>
				<p>Click 'Tag Routes' to use route tagging tool</p>
				<div style="margin:8px;"><input type="button" onclick="window.location='tag.php';" value="Tag Routes"/></div>
				{$logout_html}
			</div>
		</div> <!-- control-panel -->
		
		<div id="map-container">
			<div id="map-canvas"></div>
		</div>
  
  </body>
</html>
EOD;
