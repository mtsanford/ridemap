<?php

$result = DB_Query("SELECT MAX(ID) AS max_route_id FROM routes");

if ($result->num_rows > 0) {
	extract($result->fetch_assoc());
	$label = 'route' . ($max_route_id + 1);
} else {
	$label = '';
}


if ($id == 'new') {
	$routeID = "";
} else if (is_numeric($id)) {
	$routeID = $id;
}


if (isset($WEBSNAPR_API_KEY)) {
	$picurl =  "$WEBSNAPR_string";
	$wsinfo = "or websnapr to auto-generate thumbnail";
} else {
	$picurl =  "$scriptbase/img/www.mikworks.com.jpg";
	$wsinfo = "";
}

if (isset($_GET['lat']) && isset($_GET['lng'])) {
	$lat = $_GET['lat'];
	$lng = $_GET['lng'];
} else {
	$lat = 38;
	$lng = -122;
}

$zoom = (isset($_GET['zoom'])) ? $_GET['zoom'] : 5;

$html = <<<EOD
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Ridemap - Add/Edit a Route</title>
		<script src="//maps.googleapis.com/maps/api/js?libraries=geometry&sensor=false" type="text/javascript"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="jquery.blockUI.js"></script>
		<script src="edit2.js" type="text/javascript"></script>
		<link href="../css/ridemapadmin2.css" rel="stylesheet" type="text/css"/>
	</head>
	<body>
		<div id="edit-form">
			<form name="routeform" action="editroute.php" method="post" >
				<div id="rm_admin_inputblock">
					<div class="rm_admim_input">
						<div>Caption: </div>
						<input type="text" name="caption" size="42" maxlength="255" value="" id="caption"></input>
						<div class="rm_small">Text to display in tooltip for route's marker, and at top of info popup balloon</div>
					</div>
					<div class="rm_admim_input">
						<div>Label:</div>
						<input type="text" name="label" size="42" maxlength="63" value="{$label}" id="label"></input>
						<div class="rm_small">Internal label for this route - no spaces</div>
					</div>
					<div class="rm_admim_input">
						<div>Tags:</div>
						<input type="text" name="tags" size="42" maxlength="255" value="" id="tags"></input>
						<div class="rm_small">(optional, space separated) tags describing the route</div>
					</div>
					<div class="rm_admim_input">
						<div>Description:</div>
						<textarea rows="3" cols="32" name="description" id="description"></textarea>
						<div class="rm_small">(optional) more detailed description that appears below the picture</div>
					</div>
					<div class="rm_admim_input">
						<div>Picture URL: </div>
						<input type="text" name="picture_url" size="42" maxlength="255" value="{$picurl}"  id="picture_url"></input>
						<div class="rm_small">Picture to display in the info popup balloon for the route {$wsinfo}</div>
					</div>
					<div class="rm_admim_input">
						<div>Link URL: </div>
						<input type="text" name="link_url" size="42" maxlength="255" value=""  id="link_url"></input>
						<div class="rm_small">Link to page when user clicks on picture</div>
					</div>
					<div class="rm_admim_input">
						<div>Color: </div>
						<input type="text" name="color" id="color" size="8" maxlength="32" value="" id="color"></input>
						<div class="rm_small">this is the RGB color of the path in html format #RRGGBB</div>
					</div>
					<div id="rm_admin_buttonblock">
						<input type="button" id="submitbtn" value="submit" />
						<input type="button" id="cancel" name="cancel" value="cancel" />
						<span style="margin:20px" />
						<input type="button" id="help" name="help" value="help" />
						<div id="rm_noroute" style="font-size:x-small; color:#FF0000">You must select a route on the map before submitting</div>
					</div>
				</div>
			
				<!-- HIDDEN TABLE DATA -->
				<div style="visibility:hidden; display:none">
				<input type="text" name="edit_id" id="edit_id" size="64" maxlength="16000" value="{$routeID}" />
				<input type="text" name="way_points" id="way_points" size="64" maxlength="255" value="" />
				<input type="text" name="raw_points" id="raw_points" size="64" maxlength="16000" value="" />
				<input type="text" name="encoded_polyline" id="encoded_polyline" maxlength="16000" value="" />
				<input type="text" name="marker_pos" id="marker_pos" size="64" maxlength="64" value=""></input>
				</div>

			</form>
		</div> <!-- edit-form -->
		
		<div id="map-canvas"></div>
    
	<div style="visibility:hidden; display:none">
		<div id='pass_lat'>{$lat}</div>
		<div id='pass_lng'>{$lng}</div>
		<div id='pass_zoom'>{$zoom}</div>
	</div>

	</body>
</html>
EOD;
